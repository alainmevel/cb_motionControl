<?xml version="1.0" encoding="ISO-8859-1"?>
<!-- Generator: ControlBuild -->

<project xmlns="http://www.plcopen.org/xml/tc6_0201.xsd" xmlns:xhtml="http://www.w3.org/1999/xhtml" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.plcopen.org/xml/tc6_0201.xsd TC6_XML_V10.xsd">
	<fileHeader companyName="Dassault Syst&#232;mes" productName="ControlBuild" productVersion="2024x" creationDateTime="2023-10-04T11:03:56-01:00" />
	<contentHeader name="robotic_arm">
		<coordinateInfo>
			<fbd>
				<scaling x="100" y="100" />
			</fbd>
			<ld>
				<scaling x="100" y="100" />
			</ld>
			<sfc>
				<scaling x="32" y="8" />
			</sfc>
		</coordinateInfo>
	</contentHeader>
	<types>
		<dataTypes />
		<pous>
			<pou name="motion_control.robotic_arm" pouType="functionBlock">
				<interface>
					<inputVars>
						<variable name="armOrigin">
							<type>
								<array>
									<dimension lower="1" upper="3" />
									<baseType>
										<REAL />
									</baseType>
								</array>
							</type>
							<initialValue>
								<arrayValue>
									<value>
										<simpleValue value="235.0" />
									</value>
									<value repetitionValue="2">
										<simpleValue value="100.0" />
									</value>
								</arrayValue>
							</initialValue>
							<addData>
								<data name="Geensys.CB.libelle" handleUnknown="preserve">
									<value>x, y, z : 3D position of arm origin</value>
								</data>
								<data name="Geensys.CB.IdentifierProperty" handleUnknown="preserve">
									<value>efe37e79-d7fc-4c82-976e-3afa569a2221</value>
								</data>
								<data name="Geensys.CB.visibility" handleUnknown="preserve">
									<value>true</value>
								</data>
							</addData>
						</variable>
						<variable name="overallArmQuatInput">
							<type>
								<array>
									<dimension lower="1" upper="4" />
									<baseType>
										<REAL />
									</baseType>
								</array>
							</type>
							<initialValue>
								<arrayValue>
									<value>
										<simpleValue value="1.0" />
									</value>
									<value repetitionValue="3">
										<simpleValue value="0.0" />
									</value>
								</arrayValue>
							</initialValue>
							<addData>
								<data name="Geensys.CB.libelle" handleUnknown="preserve">
									<value>w, x, y, z : Quaternion of complete system</value>
								</data>
								<data name="Geensys.CB.IdentifierProperty" handleUnknown="preserve">
									<value>89334845-81c3-4d3e-af0a-dba7e0882f11</value>
								</data>
								<data name="Geensys.CB.visibility" handleUnknown="preserve">
									<value>true</value>
								</data>
							</addData>
						</variable>
						<variable name="structRotVector">
							<type>
								<array>
									<dimension lower="1" upper="3" />
									<baseType>
										<REAL />
									</baseType>
								</array>
							</type>
							<initialValue>
								<arrayValue>
									<value repetitionValue="2">
										<simpleValue value="0.0" />
									</value>
									<value>
										<simpleValue value="1.0" />
									</value>
								</arrayValue>
							</initialValue>
							<addData>
								<data name="Geensys.CB.libelle" handleUnknown="preserve">
									<value>x, y, z : Rotation vector for structure</value>
								</data>
								<data name="Geensys.CB.IdentifierProperty" handleUnknown="preserve">
									<value>accda650-ea50-46eb-b31c-4c3fd6e0ebcc</value>
								</data>
								<data name="Geensys.CB.visibility" handleUnknown="preserve">
									<value>true</value>
								</data>
							</addData>
						</variable>
						<variable name="structRotDeg">
							<type>
								<REAL />
							</type>
							<initialValue>
								<simpleValue value="0.0" />
							</initialValue>
							<addData>
								<data name="Geensys.CB.libelle" handleUnknown="preserve">
									<value>structure rotation</value>
								</data>
								<data name="Geensys.CB.IdentifierProperty" handleUnknown="preserve">
									<value>a5b4510e-07f1-4864-ba5c-141b3c7d8237</value>
								</data>
								<data name="Geensys.CB.visibility" handleUnknown="preserve">
									<value>true</value>
								</data>
							</addData>
						</variable>
						<variable name="driveRotVector">
							<type>
								<array>
									<dimension lower="1" upper="3" />
									<baseType>
										<REAL />
									</baseType>
								</array>
							</type>
							<initialValue>
								<arrayValue>
									<value repetitionValue="2">
										<simpleValue value="0.0" />
									</value>
									<value>
										<simpleValue value="1.0" />
									</value>
								</arrayValue>
							</initialValue>
							<addData>
								<data name="Geensys.CB.libelle" handleUnknown="preserve">
									<value>x, y, z : Rotation vector for servo drive</value>
								</data>
								<data name="Geensys.CB.IdentifierProperty" handleUnknown="preserve">
									<value>6f9c2784-34f0-43d0-9b09-49857b5dae78</value>
								</data>
								<data name="Geensys.CB.visibility" handleUnknown="preserve">
									<value>true</value>
								</data>
							</addData>
						</variable>
						<variable name="driveRotDeg">
							<type>
								<REAL />
							</type>
							<initialValue>
								<simpleValue value="0.0" />
							</initialValue>
							<addData>
								<data name="Geensys.CB.libelle" handleUnknown="preserve">
									<value>Rotation given by servo drive</value>
								</data>
								<data name="Geensys.CB.IdentifierProperty" handleUnknown="preserve">
									<value>1505d890-b5b1-46dc-8176-5c0d5ac7fc8c</value>
								</data>
								<data name="Geensys.CB.visibility" handleUnknown="preserve">
									<value>true</value>
								</data>
							</addData>
						</variable>
						<variable name="ownRotDeg">
							<type>
								<REAL />
							</type>
							<initialValue>
								<simpleValue value="0.0" />
							</initialValue>
							<addData>
								<data name="Geensys.CB.libelle" handleUnknown="preserve">
									<value>own arm rotation (offset add to driveRotDeg)</value>
								</data>
								<data name="Geensys.CB.IdentifierProperty" handleUnknown="preserve">
									<value>b25e44a9-9d91-476e-b527-117d42ad8be1</value>
								</data>
								<data name="Geensys.CB.visibility" handleUnknown="preserve">
									<value>true</value>
								</data>
							</addData>
						</variable>
						<variable name="driveResizeLength">
							<type>
								<REAL />
							</type>
							<initialValue>
								<simpleValue value="0.0" />
							</initialValue>
							<addData>
								<data name="Geensys.CB.libelle" handleUnknown="preserve">
									<value>Resize of the arm (Size added or subtracted to armLength parameter)</value>
								</data>
								<data name="Geensys.CB.IdentifierProperty" handleUnknown="preserve">
									<value>06ff3624-1dd9-45e1-9eda-41e35e7d154c</value>
								</data>
								<data name="Geensys.CB.visibility" handleUnknown="preserve">
									<value>true</value>
								</data>
							</addData>
						</variable>
						<variable name="functionActive">
							<type>
								<BOOL />
							</type>
							<initialValue>
								<simpleValue value="false" />
							</initialValue>
							<addData>
								<data name="Geensys.CB.libelle" handleUnknown="preserve">
									<value>Drive the activation (mainly, grab function, but can be different)</value>
								</data>
								<data name="Geensys.CB.IdentifierProperty" handleUnknown="preserve">
									<value>b83b2c3f-bd60-4e30-91f7-33a55beb11f4</value>
								</data>
								<data name="Geensys.CB.visibility" handleUnknown="preserve">
									<value>true</value>
								</data>
							</addData>
						</variable>
						<addData>
							<data name="Geensys.CB.kind" handleUnknown="preserve">
								<value>inputVars</value>
							</data>
						</addData>
					</inputVars>
					<outputVars>
						<variable name="armExtrem">
							<type>
								<array>
									<dimension lower="1" upper="3" />
									<baseType>
										<REAL />
									</baseType>
								</array>
							</type>
							<initialValue>
								<arrayValue>
									<value repetitionValue="3">
										<simpleValue value="0.0" />
									</value>
								</arrayValue>
							</initialValue>
							<addData>
								<data name="Geensys.CB.libelle" handleUnknown="preserve">
									<value>x, y, z : 3D position of arm extremity</value>
								</data>
								<data name="Geensys.CB.IdentifierProperty" handleUnknown="preserve">
									<value>c3ab400c-9586-4bf1-bb25-864c327a9c1d</value>
								</data>
								<data name="Geensys.CB.visibility" handleUnknown="preserve">
									<value>true</value>
								</data>
							</addData>
						</variable>
						<variable name="overallArmRotOutput">
							<type>
								<array>
									<dimension lower="1" upper="4" />
									<baseType>
										<REAL />
									</baseType>
								</array>
							</type>
							<initialValue>
								<arrayValue>
									<value repetitionValue="4">
										<simpleValue value="0.0" />
									</value>
								</arrayValue>
							</initialValue>
							<addData>
								<data name="Geensys.CB.libelle" handleUnknown="preserve">
									<value>w, x, y, z : Quaternion of complete system</value>
								</data>
								<data name="Geensys.CB.IdentifierProperty" handleUnknown="preserve">
									<value>278fc513-4b84-4485-9f83-2f296a50770c</value>
								</data>
								<data name="Geensys.CB.visibility" handleUnknown="preserve">
									<value>true</value>
								</data>
							</addData>
						</variable>
						<variable name="productId">
							<type>
								<DINT />
							</type>
							<initialValue>
								<simpleValue value="-1" />
							</initialValue>
							<addData>
								<data name="Geensys.CB.libelle" handleUnknown="preserve">
									<value>Id of the product in interaction (set by the handled object)</value>
								</data>
								<data name="Geensys.CB.IdentifierProperty" handleUnknown="preserve">
									<value>da87a544-bebe-4db3-9eb0-3ded0a935746</value>
								</data>
								<data name="Geensys.CB.visibility" handleUnknown="preserve">
									<value>true</value>
								</data>
							</addData>
						</variable>
						<addData>
							<data name="Geensys.CB.kind" handleUnknown="preserve">
								<value>outputVars</value>
							</data>
						</addData>
					</outputVars>
					<localVars>
						<variable name="status_act_prod">
							<type>
								<DINT />
							</type>
							<initialValue>
								<simpleValue value="0" />
							</initialValue>
							<addData>
								<data name="Geensys.CB.IdentifierProperty" handleUnknown="preserve">
									<value>8c95816c-b7a1-4d20-bc45-fdcd05221d5c</value>
								</data>
								<data name="Geensys.CB.visibility" handleUnknown="preserve">
									<value>true</value>
								</data>
							</addData>
						</variable>
						<variable name="m11">
							<type>
								<REAL />
							</type>
							<initialValue>
								<simpleValue value="1.0" />
							</initialValue>
							<addData>
								<data name="Geensys.CB.IdentifierProperty" handleUnknown="preserve">
									<value>959906e4-3634-4e84-9d0c-b265d02caff7</value>
								</data>
								<data name="Geensys.CB.visibility" handleUnknown="preserve">
									<value>true</value>
								</data>
							</addData>
						</variable>
						<variable name="m12">
							<type>
								<REAL />
							</type>
							<initialValue>
								<simpleValue value="0.0" />
							</initialValue>
							<addData>
								<data name="Geensys.CB.IdentifierProperty" handleUnknown="preserve">
									<value>426a0dbf-2be2-4f31-a09d-53b3a35764da</value>
								</data>
								<data name="Geensys.CB.visibility" handleUnknown="preserve">
									<value>true</value>
								</data>
							</addData>
						</variable>
						<variable name="m13">
							<type>
								<REAL />
							</type>
							<initialValue>
								<simpleValue value="0.0" />
							</initialValue>
							<addData>
								<data name="Geensys.CB.IdentifierProperty" handleUnknown="preserve">
									<value>025f3493-4250-4d39-bfc8-aa148c2c6101</value>
								</data>
								<data name="Geensys.CB.visibility" handleUnknown="preserve">
									<value>true</value>
								</data>
							</addData>
						</variable>
						<variable name="m14">
							<type>
								<REAL />
							</type>
							<initialValue>
								<simpleValue value="0.0" />
							</initialValue>
							<addData>
								<data name="Geensys.CB.IdentifierProperty" handleUnknown="preserve">
									<value>4d6dcf01-9f01-4bf7-b859-860efc58c79a</value>
								</data>
								<data name="Geensys.CB.visibility" handleUnknown="preserve">
									<value>true</value>
								</data>
							</addData>
						</variable>
						<variable name="m21">
							<type>
								<REAL />
							</type>
							<initialValue>
								<simpleValue value="0.0" />
							</initialValue>
							<addData>
								<data name="Geensys.CB.IdentifierProperty" handleUnknown="preserve">
									<value>01617c0b-4ab4-4550-bd08-9443552d4f5f</value>
								</data>
								<data name="Geensys.CB.visibility" handleUnknown="preserve">
									<value>true</value>
								</data>
							</addData>
						</variable>
						<variable name="m22">
							<type>
								<REAL />
							</type>
							<initialValue>
								<simpleValue value="1.0" />
							</initialValue>
							<addData>
								<data name="Geensys.CB.IdentifierProperty" handleUnknown="preserve">
									<value>0442ad05-4757-4fe1-85df-1893511c8f9b</value>
								</data>
								<data name="Geensys.CB.visibility" handleUnknown="preserve">
									<value>true</value>
								</data>
							</addData>
						</variable>
						<variable name="m23">
							<type>
								<REAL />
							</type>
							<initialValue>
								<simpleValue value="0.0" />
							</initialValue>
							<addData>
								<data name="Geensys.CB.IdentifierProperty" handleUnknown="preserve">
									<value>ac701420-6061-4f23-824e-4bd4c5957cb9</value>
								</data>
								<data name="Geensys.CB.visibility" handleUnknown="preserve">
									<value>true</value>
								</data>
							</addData>
						</variable>
						<variable name="m24">
							<type>
								<REAL />
							</type>
							<initialValue>
								<simpleValue value="0.0" />
							</initialValue>
							<addData>
								<data name="Geensys.CB.IdentifierProperty" handleUnknown="preserve">
									<value>d1d8c1be-2139-4c12-b494-2e437e68b476</value>
								</data>
								<data name="Geensys.CB.visibility" handleUnknown="preserve">
									<value>true</value>
								</data>
							</addData>
						</variable>
						<variable name="m31">
							<type>
								<REAL />
							</type>
							<initialValue>
								<simpleValue value="0.0" />
							</initialValue>
							<addData>
								<data name="Geensys.CB.IdentifierProperty" handleUnknown="preserve">
									<value>1e189af0-c4ce-4354-a014-9c7db7b01a74</value>
								</data>
								<data name="Geensys.CB.visibility" handleUnknown="preserve">
									<value>true</value>
								</data>
							</addData>
						</variable>
						<variable name="m32">
							<type>
								<REAL />
							</type>
							<initialValue>
								<simpleValue value="0.0" />
							</initialValue>
							<addData>
								<data name="Geensys.CB.IdentifierProperty" handleUnknown="preserve">
									<value>e2625fa7-b457-412a-a0b6-0c8746b4a6a6</value>
								</data>
								<data name="Geensys.CB.visibility" handleUnknown="preserve">
									<value>true</value>
								</data>
							</addData>
						</variable>
						<variable name="m33">
							<type>
								<REAL />
							</type>
							<initialValue>
								<simpleValue value="1.0" />
							</initialValue>
							<addData>
								<data name="Geensys.CB.IdentifierProperty" handleUnknown="preserve">
									<value>080692b3-3b4f-43f1-83c5-fde1ae974506</value>
								</data>
								<data name="Geensys.CB.visibility" handleUnknown="preserve">
									<value>true</value>
								</data>
							</addData>
						</variable>
						<variable name="m34">
							<type>
								<REAL />
							</type>
							<initialValue>
								<simpleValue value="0.0" />
							</initialValue>
							<addData>
								<data name="Geensys.CB.IdentifierProperty" handleUnknown="preserve">
									<value>2bd8406c-5671-4c2a-8d13-1ad9f497c03d</value>
								</data>
								<data name="Geensys.CB.visibility" handleUnknown="preserve">
									<value>true</value>
								</data>
							</addData>
						</variable>
						<variable name="m41">
							<type>
								<REAL />
							</type>
							<initialValue>
								<simpleValue value="0.0" />
							</initialValue>
							<addData>
								<data name="Geensys.CB.IdentifierProperty" handleUnknown="preserve">
									<value>e9640a31-8181-48cd-bc48-21a11ace80a6</value>
								</data>
								<data name="Geensys.CB.visibility" handleUnknown="preserve">
									<value>true</value>
								</data>
							</addData>
						</variable>
						<variable name="m42">
							<type>
								<REAL />
							</type>
							<initialValue>
								<simpleValue value="0.0" />
							</initialValue>
							<addData>
								<data name="Geensys.CB.IdentifierProperty" handleUnknown="preserve">
									<value>26980d7a-42c3-41a6-b15f-159779b8ba2e</value>
								</data>
								<data name="Geensys.CB.visibility" handleUnknown="preserve">
									<value>true</value>
								</data>
							</addData>
						</variable>
						<variable name="m43">
							<type>
								<REAL />
							</type>
							<initialValue>
								<simpleValue value="0.0" />
							</initialValue>
							<addData>
								<data name="Geensys.CB.IdentifierProperty" handleUnknown="preserve">
									<value>ce3102f4-4c3b-4032-95d6-55d661b453f6</value>
								</data>
								<data name="Geensys.CB.visibility" handleUnknown="preserve">
									<value>true</value>
								</data>
							</addData>
						</variable>
						<variable name="m44">
							<type>
								<REAL />
							</type>
							<initialValue>
								<simpleValue value="1.0" />
							</initialValue>
							<addData>
								<data name="Geensys.CB.IdentifierProperty" handleUnknown="preserve">
									<value>6dab7bde-847d-44f1-a914-52f96fcba0c7</value>
								</data>
								<data name="Geensys.CB.visibility" handleUnknown="preserve">
									<value>true</value>
								</data>
							</addData>
						</variable>
						<variable name="armLengthCalc">
							<type>
								<REAL />
							</type>
							<initialValue>
								<simpleValue value="0.0" />
							</initialValue>
							<addData>
								<data name="Geensys.CB.libelle" handleUnknown="preserve">
									<value>= armLength + driveResizeLength</value>
								</data>
								<data name="Geensys.CB.IdentifierProperty" handleUnknown="preserve">
									<value>cfd3d1d2-84e7-47b4-abe5-104646e4dd4e</value>
								</data>
								<data name="Geensys.CB.visibility" handleUnknown="preserve">
									<value>true</value>
								</data>
							</addData>
						</variable>
						<variable name="functionActiveLocale">
							<type>
								<BOOL />
							</type>
							<initialValue>
								<simpleValue value="false" />
							</initialValue>
							<addData>
								<data name="Geensys.CB.libelle" handleUnknown="preserve">
									<value> function of the arm is active (mainly, grab function, but can be different because used by handled object)</value>
								</data>
								<data name="Geensys.CB.IdentifierProperty" handleUnknown="preserve">
									<value>7345455c-7329-49b5-bd26-a038c6afdaff</value>
								</data>
								<data name="Geensys.CB.visibility" handleUnknown="preserve">
									<value>true</value>
								</data>
							</addData>
						</variable>
						<variable name="product_id">
							<type>
								<DINT />
							</type>
							<initialValue>
								<simpleValue value="-1" />
							</initialValue>
							<addData>
								<data name="Geensys.CB.libelle" handleUnknown="preserve">
									<value>Id of the product in interaction (set by the handled object)</value>
								</data>
								<data name="Geensys.CB.IdentifierProperty" handleUnknown="preserve">
									<value>5a11af91-c8e4-4321-babb-5d5d0567c3bc</value>
								</data>
								<data name="Geensys.CB.visibility" handleUnknown="preserve">
									<value>true</value>
								</data>
							</addData>
						</variable>
						<variable name="arm_id">
							<type>
								<DINT />
							</type>
							<initialValue>
								<simpleValue value="-1" />
							</initialValue>
							<addData>
								<data name="Geensys.CB.libelle" handleUnknown="preserve">
									<value>own actor Id</value>
								</data>
								<data name="Geensys.CB.IdentifierProperty" handleUnknown="preserve">
									<value>f58071f7-0404-49a8-a499-a02278e3dd8f</value>
								</data>
								<data name="Geensys.CB.visibility" handleUnknown="preserve">
									<value>true</value>
								</data>
							</addData>
						</variable>
						<variable name="timeToGripParam">
							<type>
								<REAL />
							</type>
							<initialValue>
								<simpleValue value="0.15" />
							</initialValue>
							<addData>
								<data name="Geensys.CB.libelle" handleUnknown="preserve">
									<value>Grab action delay after arm is in contact with the object (parameter used by the handled object)</value>
								</data>
								<data name="Geensys.CB.IdentifierProperty" handleUnknown="preserve">
									<value>edf16abc-6868-48a3-aa47-2ab7b40e1297</value>
								</data>
								<data name="Geensys.CB.visibility" handleUnknown="preserve">
									<value>true</value>
								</data>
							</addData>
						</variable>
						<addData>
							<data name="Geensys.CB.kind" handleUnknown="preserve">
								<value>localVars</value>
							</data>
						</addData>
					</localVars>
					<localVars constant="true">
						<variable name="armLength">
							<type>
								<REAL />
							</type>
							<initialValue>
								<simpleValue value="100.0" />
							</initialValue>
							<addData>
								<data name="Geensys.CB.libelle" handleUnknown="preserve">
									<value>along x Axis</value>
								</data>
								<data name="Geensys.CB.IdentifierProperty" handleUnknown="preserve">
									<value>3c7b21a9-1671-42ea-8cd4-05963ccbfb3e</value>
								</data>
								<data name="Geensys.CB.visibility" handleUnknown="preserve">
									<value>true</value>
								</data>
							</addData>
						</variable>
						<variable name="armWidth">
							<type>
								<REAL />
							</type>
							<initialValue>
								<simpleValue value="5.0" />
							</initialValue>
							<addData>
								<data name="Geensys.CB.libelle" handleUnknown="preserve">
									<value>along y Axis</value>
								</data>
								<data name="Geensys.CB.IdentifierProperty" handleUnknown="preserve">
									<value>67be0d2d-990c-4a32-a285-e6cef278e13f</value>
								</data>
								<data name="Geensys.CB.visibility" handleUnknown="preserve">
									<value>true</value>
								</data>
							</addData>
						</variable>
						<variable name="armHeight">
							<type>
								<REAL />
							</type>
							<initialValue>
								<simpleValue value="5.0" />
							</initialValue>
							<addData>
								<data name="Geensys.CB.libelle" handleUnknown="preserve">
									<value>along z Axis</value>
								</data>
								<data name="Geensys.CB.IdentifierProperty" handleUnknown="preserve">
									<value>8c0f7c7a-3ad0-4138-8ee6-76c837a158b7</value>
								</data>
								<data name="Geensys.CB.visibility" handleUnknown="preserve">
									<value>true</value>
								</data>
							</addData>
						</variable>
						<variable name="armType">
							<type>
								<INT />
							</type>
							<initialValue>
								<simpleValue value="0" />
							</initialValue>
							<addData>
								<data name="Geensys.CB.libelle" handleUnknown="preserve">
									<value>used by handled object to behave differently</value>
								</data>
								<data name="Geensys.CB.IdentifierProperty" handleUnknown="preserve">
									<value>1b055c4d-a071-4412-a57b-efd9d11c8388</value>
								</data>
								<data name="Geensys.CB.visibility" handleUnknown="preserve">
									<value>true</value>
								</data>
							</addData>
						</variable>
						<addData>
							<data name="Geensys.CB.kind" handleUnknown="preserve">
								<value>parameterVars</value>
							</data>
						</addData>
					</localVars>
					<addData>
					</addData>
				</interface>
				<actions>
					<action name="C_source_code">
						<body>
							<ST>/* ----------------------------------------------------------------&#9;*/
/* Type : Model of Operative Behaviour&#9;&#9;&#9;&#9;&#9;*/
/* Category :  Motion control&#9;&#9;&#9;&#9;&#9;&#9;*/
/* Author : Dassault Systemes&#9;&#9;&#9;&#9;&#9;&#9;*/
/* Update date : June 2021&#9;&#9;&#9;&#9;&#9;&#9;&#9;*/
/* ----------------------------------------------------------------&#9;*/
/* This module simulates the behaviour of a robotic arm&#9;&#9;*/
/* ----------------------------------------------------------------&#9;*/

arm_id = myself;
productId = product_id; // copy to output for miscelleanous use
product_id = -1;
functionActiveLocale = functionActive;

armLengthCalc = armLength + driveResizeLength;
if (armLengthCalc &lt; 0.0) armLengthCalc = 0.0;

// *** position of current arm relatively to origin ***
double extrem[3];
extrem[0] = armLengthCalc;
extrem[1] = 0;
extrem[2] = 0;

// *** Compute structRotation applying structRotDeg ***
double structAxis[3];
Quaternion structRotation;
structAxis[0] = structRotVector(1); structAxis[1] = structRotVector(2); structAxis[2] = structRotVector(3);
Quaternion_fromAxisAngle(structAxis, structRotDeg*M_PI/180, &amp;structRotation);
Quaternion_normalize(&amp;structRotation, &amp;structRotation);

// *** Compute rotation applying driveRotDeg &amp; ownRotDeg ***
double axis[3];
Quaternion rotation;
axis[0] = driveRotVector(1); axis[1] = driveRotVector(2); axis[2] = driveRotVector(3);
Quaternion_fromAxisAngle(axis, (driveRotDeg + ownRotDeg)*M_PI/180, &amp;rotation);
Quaternion_normalize(&amp;rotation, &amp;rotation);

// *** Get overall quaterniom coming from previous arm ***
Quaternion overall;
overall.w = overallArmQuatInput(1); //w 
overall.v[0] = overallArmQuatInput(2); //cx 
overall.v[1] = overallArmQuatInput(3); //cy 
overall.v[2] = overallArmQuatInput(4); //cz

// *** Add current rotations to get next overall quaternion ***
Quaternion_multiply(&amp;overall, &amp;structRotation, &amp;overall);
Quaternion_multiply(&amp;overall, &amp;rotation, &amp;overall);
overallArmRotOutput(1) = overall.w;
overallArmRotOutput(2) = overall.v[0];
overallArmRotOutput(3) = overall.v[1];
overallArmRotOutput(4) = overall.v[2];

// *** Apply overall rotation to current arm relatively to origin
Quaternion_rotate(&amp;overall, extrem, extrem); 

// *** Shift current arm to previous arm extremity ***
armExtrem(1) = armOrigin(1) + extrem[0];
armExtrem(2) = armOrigin(2) + extrem[1];
armExtrem(3) = armOrigin(3) + extrem[2];

// *** display in ControlBuild coordinate system ***
double eulerAngles[3];
Quaternion_toEulerZYX(&amp;overall , eulerAngles);

if (armLengthCalc == 0.0) armLengthCalc = 0.001;
resizeTo(myself, armLengthCalc, armWidth, armHeight);

rotateTo(myself,0.0 , 0.0 , 0.0, 0.0, 0.0, 0.0);
moveTo(myself, 0.0, -armWidth/2.0, ROT_REFZ-armHeight/2.0);
rotateBy(myself,eulerAngles[0]*180/M_PI ,eulerAngles[1]*180/M_PI ,eulerAngles[2]*180/M_PI, 0.0, 0.0, ROT_REFZ);
moveBy(myself, armOrigin(1), armOrigin(2), armOrigin(3)-ROT_REFZ); 



</ST>
						</body>
					</action>
					<action name="C_header">
						<body>
							<ST>
#define ROT_REFZ 5000.0// offset of the Z position used for intermediate rotations

#pragma once
#include &lt;stdbool.h&gt;
#include &lt;stdint.h&gt;
#include &lt;stdio.h&gt;
#include &lt;math.h&gt;
#include &lt;stdlib.h&gt;
#include &lt;assert.h&gt;

typedef struct Quaternion {
&#9;double w;&#9;   /**&lt; Scalar part */
&#9;double v[3];&#9;/**&lt; Vector part */
} Quaternion;

void Quaternion_fromAxisAngle(double axis[3], double angle, Quaternion* output);
double Quaternion_norm(Quaternion* q);
void Quaternion_normalize(Quaternion* q, Quaternion* output);
void Quaternion_multiply(Quaternion* q1, Quaternion* q2, Quaternion* output);
void Quaternion_rotate(Quaternion* q, double v[3], double output[3]);

void Quaternion_set(double w, double v1, double v2, double v3, Quaternion* output) {
&#9;output-&gt;w = w;
&#9;output-&gt;v[0] = v1;
&#9;output-&gt;v[1] = v2;
&#9;output-&gt;v[2] = v3;
}

void Quaternion_fromAxisAngle(double axis[3], double angle, Quaternion* output) {
&#9;output-&gt;w = cos(angle / 2.0);
&#9;double c = sin(angle / 2.0);
&#9;output-&gt;v[0] = c * axis[0];
&#9;output-&gt;v[1] = c * axis[1];
&#9;output-&gt;v[2] = c * axis[2];
}

double Quaternion_norm(Quaternion* q) {
&#9;return sqrt(q-&gt;w*q-&gt;w + q-&gt;v[0]*q-&gt;v[0] + q-&gt;v[1]*q-&gt;v[1] + q-&gt;v[2]*q-&gt;v[2]);
}

void Quaternion_normalize(Quaternion* q, Quaternion* output) {
&#9;double len = Quaternion_norm(q);
&#9;Quaternion_set(
&#9;&#9;q-&gt;w / len,
&#9;&#9;q-&gt;v[0] / len,
&#9;&#9;q-&gt;v[1] / len,
&#9;&#9;q-&gt;v[2] / len,
&#9;&#9;output);
}

void Quaternion_multiply(Quaternion* q1, Quaternion* q2, Quaternion* output) {
&#9;assert(output != NULL);
&#9;Quaternion result;
&#9;result.w =&#9;q1-&gt;w * q2-&gt;w - q1-&gt;v[0] * q2-&gt;v[0] - q1-&gt;v[1] * q2-&gt;v[1] - q1-&gt;v[2] * q2-&gt;v[2];
&#9;result.v[0] = q1-&gt;v[0] * q2-&gt;w + q1-&gt;w * q2-&gt;v[0] + q1-&gt;v[1] * q2-&gt;v[2] - q1-&gt;v[2] * q2-&gt;v[1];
&#9;result.v[1] = q1-&gt;w * q2-&gt;v[1] - q1-&gt;v[0] * q2-&gt;v[2] + q1-&gt;v[1] * q2-&gt;w + q1-&gt;v[2] * q2-&gt;v[0];
&#9;result.v[2] = q1-&gt;w * q2-&gt;v[2] + q1-&gt;v[0] * q2-&gt;v[1] - q1-&gt;v[1] * q2-&gt;v[0] + q1-&gt;v[2] * q2-&gt;w   ;

&#9;*output = result;
}

void Quaternion_rotate(Quaternion* q, double v[3], double output[3]) {
&#9;assert(output != NULL);
&#9;double result[3];

&#9;double ww = q-&gt;w * q-&gt;w;
&#9;double xx = q-&gt;v[0] * q-&gt;v[0];
&#9;double yy = q-&gt;v[1] * q-&gt;v[1];
&#9;double zz = q-&gt;v[2] * q-&gt;v[2];
&#9;double wx = q-&gt;w * q-&gt;v[0];
&#9;double wy = q-&gt;w * q-&gt;v[1];
&#9;double wz = q-&gt;w * q-&gt;v[2];
&#9;double xy = q-&gt;v[0] * q-&gt;v[1];
&#9;double xz = q-&gt;v[0] * q-&gt;v[2];
&#9;double yz = q-&gt;v[1] * q-&gt;v[2];

&#9;result[0] = ww*v[0] + 2*wy*v[2] - 2*wz*v[1] +
&#9;&#9;&#9;&#9;xx*v[0] + 2*xy*v[1] + 2*xz*v[2] -
&#9;&#9;&#9;&#9;zz*v[0] - yy*v[0];
&#9;result[1] = 2*xy*v[0] + yy*v[1] + 2*yz*v[2] +
&#9;&#9;&#9;&#9;2*wz*v[0] - zz*v[1] + ww*v[1] -
&#9;&#9;&#9;&#9;2*wx*v[2] - xx*v[1];
&#9;result[2] = 2*xz*v[0] + 2*yz*v[1] + zz*v[2] -
&#9;&#9;&#9;&#9;2*wy*v[0] - yy*v[2] + 2*wx*v[1] -
&#9;&#9;&#9;&#9;xx*v[2] + ww*v[2];

&#9;output[0] = result[0];
&#9;output[1] = result[1];
&#9;output[2] = result[2];
}

void Quaternion_toEulerZYX(Quaternion* q, double output[3]) {
&#9;assert(output != NULL);

&#9;// Roll (x-axis rotation)
&#9;double sinr_cosp = +2.0 * (q-&gt;w * q-&gt;v[0] + q-&gt;v[1] * q-&gt;v[2]);
&#9;double cosr_cosp = +1.0 - 2.0 * (q-&gt;v[0] * q-&gt;v[0] + q-&gt;v[1] * q-&gt;v[1]);
&#9;output[0] = atan2(sinr_cosp, cosr_cosp);
&#9;

&#9;// Pitch (y-axis rotation)
&#9;double sinp = +2.0 * (q-&gt;w * q-&gt;v[1] - q-&gt;v[2] * q-&gt;v[0]);
&#9;if (fabs(sinp) &gt;= 1)
&#9;&#9;output[1] = copysign(M_PI / 2, sinp); // use 90 degrees if out of range
&#9;else
&#9;&#9;output[1] = asin(sinp);

&#9;// Yaw (z-axis rotation)
&#9;double siny_cosp = +2.0 * (q-&gt;w * q-&gt;v[2] + q-&gt;v[0] * q-&gt;v[1]);
&#9;double cosy_cosp = +1.0 - 2.0 * (q-&gt;v[1] * q-&gt;v[1] + q-&gt;v[2] * q-&gt;v[2]);
&#9;output[2] = atan2(siny_cosp, cosy_cosp);
}
</ST>
						</body>
					</action>
				</actions>
				<addData>
					<data name="Geensys.CB.Actor" handleUnknown="preserve">
						<value>true</value>
					</data>
					<data name="Geensys.CB.INSTANCE_NAMIMG_PATTERN" handleUnknown="preserve">
						<value></value>
					</data>
					<data name="Geensys.CB.COMMENTS_PATTERN" handleUnknown="preserve">
						<value></value>
					</data>
				</addData>
				<documentation>
					<xhtml:pre>This module simulates a single robot arm with rotation calculations</xhtml:pre>
				</documentation>
			</pou>
		</pous>
	</types>
	<instances>
		<configurations />
	</instances>
</project>